<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Sistema de Notifica√ß√µes Multi-Canal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .notification-container {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            max-width: 400px;
        }
        
        .notification-top-right {
            top: 20px;
            right: 20px;
        }
        
        .notification {
            pointer-events: auto;
            margin-bottom: 10px;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            max-width: 100%;
            word-wrap: break-word;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .notification-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .notification-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .notification-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .notification-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        
        .notification-urgent {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .notification-icon {
            font-size: 24px;
            flex-shrink: 0;
            margin-right: 12px;
        }
        
        .notification-content {
            flex: 1;
            min-width: 0;
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .notification-message {
            font-size: 13px;
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: inherit;
            font-size: 18px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            opacity: 0.7;
            transition: opacity 0.2s;
            flex-shrink: 0;
            margin-left: 12px;
        }
        
        .notification-close:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .notification-enter {
            animation: slideInRight 0.3s ease-out;
        }
        
        .notification-exit {
            animation: slideOutRight 0.3s ease-in;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-4">üîî Sistema de Notifica√ß√µes Multi-Canal</h1>
                <p class="text-gray-600 mb-6">
                    Teste completo do sistema de notifica√ß√µes implementado para o TeleMed.
                    Este sistema inclui notifica√ß√µes push do navegador, integra√ß√£o WhatsApp/Email, 
                    notifica√ß√µes de proximidade e alertas sonoros.
                </p>
                
                <!-- Status das Permiss√µes -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-bold text-blue-900 mb-2">Status das Permiss√µes:</h3>
                    <div id="permissionStatus" class="text-sm text-blue-800">
                        Verificando permiss√µes...
                    </div>
                </div>
            </div>

            <!-- Controles de Teste -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Notifica√ß√µes B√°sicas -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">üì± Notifica√ß√µes B√°sicas</h2>
                    <div class="space-y-3">
                        <button onclick="testSuccessNotification()" 
                                class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            ‚úÖ Teste Sucesso
                        </button>
                        <button onclick="testInfoNotification()" 
                                class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            ‚ÑπÔ∏è Teste Informa√ß√£o
                        </button>
                        <button onclick="testWarningNotification()" 
                                class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition">
                            ‚ö†Ô∏è Teste Aviso
                        </button>
                        <button onclick="testErrorNotification()" 
                                class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                            ‚ùå Teste Erro
                        </button>
                    </div>
                </div>

                <!-- Notifica√ß√µes Push do Navegador -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">üåê Push Notifications</h2>
                    <div class="space-y-3">
                        <button onclick="requestNotificationPermission()" 
                                class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                            üîî Solicitar Permiss√£o
                        </button>
                        <button onclick="testBrowserPushNotification()" 
                                class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                            üì± Teste Push Notification
                        </button>
                        <button onclick="testPersistentNotification()" 
                                class="w-full px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition">
                            üìå Notifica√ß√£o Persistente
                        </button>
                    </div>
                </div>

                <!-- Notifica√ß√µes de Proximidade -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">üéØ Notifica√ß√µes de Proximidade</h2>
                    <div class="space-y-3">
                        <button onclick="testProximityNotification(5)" 
                                class="w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                            üü° Posi√ß√£o 5 na Fila
                        </button>
                        <button onclick="testProximityNotification(3)" 
                                class="w-full px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition">
                            üü† Posi√ß√£o 3 na Fila (Proximidade)
                        </button>
                        <button onclick="testProximityNotification(1)" 
                                class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            üü¢ Pr√≥ximo na Fila
                        </button>
                        <button onclick="testConsultationReady()" 
                                class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                            üî¥ Consulta Pronta!
                        </button>
                    </div>
                </div>

                <!-- Alertas Sonoros -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">üîä Alertas Sonoros</h2>
                    <div class="space-y-3">
                        <button onclick="testProximitySound()" 
                                class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            üéµ Som de Proximidade
                        </button>
                        <button onclick="testCallSound()" 
                                class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                            üìû Som de Chamada
                        </button>
                        <button onclick="stopAllSounds()" 
                                class="w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                            üîá Parar Todos os Sons
                        </button>
                        <button onclick="toggleNotificationSound()" 
                                class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition">
                            üîä Alternar Som
                        </button>
                    </div>
                </div>

                <!-- Notifica√ß√µes do Sistema -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">üè• Notifica√ß√µes do Sistema</h2>
                    <div class="space-y-3">
                        <button onclick="testPaymentConfirmation()" 
                                class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            üí≥ Confirma√ß√£o de Pagamento
                        </button>
                        <button onclick="testQueuePositionUpdate()" 
                                class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            üìä Atualiza√ß√£o de Posi√ß√£o
                        </button>
                        <button onclick="testAppointmentReminder()" 
                                class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                            üìÖ Lembrete de Consulta
                        </button>
                    </div>
                </div>

                <!-- Integra√ß√£o WhatsApp/Email -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">üì± WhatsApp & Email</h2>
                    <div class="space-y-3">
                        <button onclick="testWhatsAppNotification()" 
                                class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            üì± Teste WhatsApp (Simulado)
                        </button>
                        <button onclick="testEmailNotification()" 
                                class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            üìß Teste Email (Simulado)
                        </button>
                        <div class="text-sm text-gray-600 mt-2">
                            <p>‚ö†Ô∏è WhatsApp e Email est√£o em modo simulado</p>
                            <p>Em produ√ß√£o, requerem configura√ß√£o de APIs</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Controles Gerais -->
            <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4">‚öôÔ∏è Controles Gerais</h2>
                <div class="flex flex-wrap gap-4">
                    <button onclick="showDemoNotifications()" 
                            class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                        üé≠ Demo Completo
                    </button>
                    <button onclick="clearAllNotifications()" 
                            class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                        üóëÔ∏è Limpar Todas
                    </button>
                    <button onclick="exportNotificationSettings()" 
                            class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                        üíæ Exportar Configura√ß√µes
                    </button>
                </div>
            </div>

            <!-- Log de Atividades -->
            <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4">üìã Log de Atividades</h2>
                <div id="activityLog" class="bg-gray-50 rounded-lg p-4 h-64 overflow-y-auto text-sm font-mono">
                    <div class="text-gray-500">Aguardando atividades...</div>
                </div>
            </div>

        </div>
    </div>

    <!-- Scripts -->
    <script src="js/notifications.js"></script>
    <script>
        // Fun√ß√µes de teste espec√≠ficas
        function testSuccessNotification() {
            showSuccessNotification('Teste de Sucesso', 'Esta √© uma notifica√ß√£o de sucesso para teste');
            logActivity('‚úÖ Notifica√ß√£o de sucesso enviada');
        }

        function testInfoNotification() {
            showInfoNotification('Teste de Informa√ß√£o', 'Esta √© uma notifica√ß√£o informativa para teste');
            logActivity('‚ÑπÔ∏è Notifica√ß√£o informativa enviada');
        }

        function testWarningNotification() {
            showWarningNotification('Teste de Aviso', 'Esta √© uma notifica√ß√£o de aviso para teste');
            logActivity('‚ö†Ô∏è Notifica√ß√£o de aviso enviada');
        }

        function testErrorNotification() {
            showErrorNotification('Teste de Erro', 'Esta √© uma notifica√ß√£o de erro para teste');
            logActivity('‚ùå Notifica√ß√£o de erro enviada');
        }

        function testBrowserPushNotification() {
            sendBrowserPushNotification(
                'Teste Push Notification',
                'Esta √© uma notifica√ß√£o push do navegador',
                {
                    tag: 'test-notification',
                    requireInteraction: false
                }
            );
            logActivity('üì± Push notification enviada');
        }

        function testPersistentNotification() {
            sendBrowserPushNotification(
                'Notifica√ß√£o Persistente',
                'Esta notifica√ß√£o requer intera√ß√£o do usu√°rio',
                {
                    tag: 'persistent-notification',
                    requireInteraction: true
                }
            );
            logActivity('üìå Notifica√ß√£o persistente enviada');
        }

        function testProximityNotification(position) {
            checkProximityNotifications(position);
            logActivity(`üéØ Teste de proximidade - Posi√ß√£o ${position}`);
        }

        function testConsultationReady() {
            sendConsultationReadyNotification({
                name: 'Dr. Jo√£o Silva',
                specialty: 'Cardiologia'
            });
            logActivity('üé• Notifica√ß√£o de consulta pronta enviada');
        }

        function testProximitySound() {
            if (typeof playProximitySound === 'function') {
                playProximitySound();
                logActivity('üéµ Som de proximidade tocado');
            } else {
                logActivity('‚ùå Fun√ß√£o playProximitySound n√£o encontrada');
            }
        }

        function testCallSound() {
            playCallSound();
            logActivity('üìû Som de chamada iniciado');
        }

        function stopAllSounds() {
            stopCallSound();
            logActivity('üîá Todos os sons parados');
        }

        function testPaymentConfirmation() {
            sendPaymentConfirmationNotification({
                id: 'test-123',
                specialty: 'Cardiologia',
                price: 89.90,
                queuePosition: 3,
                patientPhone: '+5511999999999',
                patientEmail: 'paciente@teste.com'
            });
            logActivity('üí≥ Notifica√ß√£o de confirma√ß√£o de pagamento enviada');
        }

        function testQueuePositionUpdate() {
            sendQueuePositionUpdateNotification(2, 15);
            logActivity('üìä Notifica√ß√£o de atualiza√ß√£o de posi√ß√£o enviada');
        }

        function testAppointmentReminder() {
            showAppointmentReminder({
                doctor: 'Dr. Jo√£o Silva',
                specialty: 'Cardiologia',
                id: 'test-123'
            });
            logActivity('üìÖ Lembrete de consulta enviado');
        }

        function testWhatsAppNotification() {
            sendWhatsAppNotification(
                '+5511999999999',
                'Teste de mensagem WhatsApp do sistema TeleMed'
            );
            logActivity('üì± Notifica√ß√£o WhatsApp enviada (simulado)');
        }

        function testEmailNotification() {
            sendEmailNotification(
                'paciente@teste.com',
                'Teste de Email TeleMed',
                'Esta √© uma mensagem de teste do sistema de email.',
                {
                    actionUrl: window.location.origin,
                    actionText: 'Acessar Plataforma'
                }
            );
            logActivity('üìß Notifica√ß√£o por email enviada (simulado)');
        }

        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                updatePermissionStatus();
                logActivity(`üîî Permiss√£o de notifica√ß√£o: ${permission}`);
            } else {
                logActivity('‚ùå Notifica√ß√µes n√£o suportadas neste navegador');
            }
        }

        function updatePermissionStatus() {
            const statusDiv = document.getElementById('permissionStatus');
            if ('Notification' in window) {
                const permission = Notification.permission;
                let status = '';
                let color = '';
                
                switch (permission) {
                    case 'granted':
                        status = '‚úÖ Notifica√ß√µes permitidas';
                        color = 'text-green-800';
                        break;
                    case 'denied':
                        status = '‚ùå Notifica√ß√µes negadas';
                        color = 'text-red-800';
                        break;
                    case 'default':
                        status = '‚è≥ Permiss√£o n√£o solicitada';
                        color = 'text-yellow-800';
                        break;
                }
                
                statusDiv.innerHTML = `
                    <div class="${color}">
                        <strong>Push Notifications:</strong> ${status}
                    </div>
                    <div class="text-blue-800 mt-1">
                        <strong>WhatsApp:</strong> üì± Simulado (requer API)
                    </div>
                    <div class="text-blue-800">
                        <strong>Email:</strong> üìß Simulado (requer API)
                    </div>
                `;
            } else {
                statusDiv.innerHTML = '<div class="text-red-800">‚ùå Notifica√ß√µes n√£o suportadas</div>';
            }
        }

        function logActivity(message) {
            const logDiv = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const logEntry = document.createElement('div');
            logEntry.className = 'mb-1';
            logEntry.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${message}`;
            
            // Remove mensagem inicial se existir
            const emptyMessage = logDiv.querySelector('.text-gray-500');
            if (emptyMessage && emptyMessage.textContent === 'Aguardando atividades...') {
                emptyMessage.remove();
            }
            
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            updatePermissionStatus();
            logActivity('üöÄ Sistema de notifica√ß√µes multi-canal carregado');
            
            // Verificar se as fun√ß√µes est√£o dispon√≠veis
            const functions = [
                'showNotification',
                'sendBrowserPushNotification',
                'sendWhatsAppNotification',
                'sendEmailNotification',
                'checkProximityNotifications',
                'playCallSound'
            ];
            
            functions.forEach(func => {
                if (typeof window[func] === 'function') {
                    logActivity(`‚úÖ Fun√ß√£o ${func} dispon√≠vel`);
                } else {
                    logActivity(`‚ùå Fun√ß√£o ${func} n√£o encontrada`);
                }
            });
        });

        // Utility function para formatar moeda
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }
    </script>
</body>
</html>